#!/bin/bash
# Claude-Codex 双窗口模式 ask命令简化版

SCRIPT_DIR="/home/bfly/运维/基本问题"

# 检查是否有活动会话
if [ ! -f "./.codex-session" ]; then
    echo "❌ 未找到活动会话，请先启动双窗口模式"
    echo "💡 启动命令: $SCRIPT_DIR/claude-codex-dual-simple"
    exit 1
fi

# 读取会话信息
SESSION_ID=$(cat "./.codex-session" | python3 -c "import sys, json; print(json.load(sys.stdin)['session_id'])")
RUNTIME_DIR="/tmp/codex-bfly/$SESSION_ID"
INPUT_FIFO="$RUNTIME_DIR/input.fifo"

# 检查管道是否存在
if [ ! -p "$INPUT_FIFO" ]; then
    echo "❌ 通信管道不存在，会话可能已损坏"
    echo "💡 请重新启动双窗口模式"
    exit 1
fi

# 获取问题内容
if [ $# -eq 0 ]; then
    echo "❌ 请提供问题内容"
    echo "💡 用法: dual-ask <问题内容>"
    exit 1
fi

QUESTION="$*"

# 发送问题到Codex
echo "$QUESTION" > "$INPUT_FIFO"

if [ $? -eq 0 ]; then
    echo "✅ 已发送到Codex: $QUESTION"
else
    echo "❌ 发送失败"
    exit 1
fi