# Codex 后台服务测试清单

## 🎯 测试目标

验证 Codex 后台服务的完整性和稳定性，确保所有功能正常工作。

## ✅ 核心功能测试

### 1. 基础服务管理
- [ ] `/codex-start` - 服务启动
- [ ] `/codex-stop` - 服务停止
- [ ] `/codex-status` - 状态查询
- [ ] `/codex-help` - 帮助信息

### 2. 问答功能
- [ ] `/codex-ask` - 基本问答
- [ ] 多轮对话连续性
- [ ] 长文本处理
- [ ] 特殊字符处理

### 3. 配置管理
- [ ] `/codex-config` - 查看配置
- [ ] `/codex-config high` - 高性能档位
- [ ] `/codex-config default` - 默认档位
- [ ] `/codex-config low` - 简洁档位
- [ ] `/codex-reasoning on/off` - 推理显示
- [ ] `/codex-final_only on/off` - 输出格式

### 4. 会话管理
- [ ] 会话持久化
- [ ] 重启恢复
- [ ] 配置记忆
- [ ] 历史记录

## 🔧 异常场景测试

### 1. 未激活状态
- [ ] 未激活时执行问答命令
- [ ] 未激活时执行配置命令
- [ ] 未激活时查询状态

### 2. 非法参数
- [ ] 无效的 profile 参数
- [ ] 无效的 reasoning 参数
- [ ] 无效的 final_only 参数
- [ ] 缺少必要参数的命令

### 3. 命令格式
- [ ] 未知命令处理
- [ ] 缺少斜杠前缀
- [ ] 空命令处理

### 4. 系统异常
- [ ] 子进程崩溃恢复
- [ ] Socket 连接异常
- [ ] 磁盘空间不足
- [ ] 权限问题

### 5. 并发场景
- [ ] 多个并发请求
- [ ] 同时配置更改
- [ ] 启动/停止并发

## 🧪 测试脚本

### 1. 完整工作流测试
```bash
python3 test/test_codex_workflow.py
```

**验证内容：**
- 服务启动 → 多轮问答 → 档位切换 → 开关控制 → 重启恢复 → 功能验证

### 2. 异常场景测试
```bash
python3 test/test_codex_exceptions.py
```

**验证内容：**
- 错误处理机制、异常恢复能力、边界条件处理

### 3. 手动测试命令
```python
from codex_commands import handle_codex_command

# 基础功能测试
handle_codex_command('/codex-start')
handle_codex_command('/codex-ask 测试问题')
handle_codex_command('/codex-status')
handle_codex_command('/codex-stop')
```

## 📊 性能指标

### 1. 响应时间
- [ ] 启动时间 < 3秒
- [ ] 问答响应 < 10秒
- [ ] 配置切换 < 1秒
- [ ] 重启恢复 < 5秒

### 2. 资源使用
- [ ] 内存使用 < 100MB
- [ ] CPU 使用率 < 20%（空闲时）
- [ ] 临时文件大小合理
- [ ] 进程数量稳定

### 3. 稳定性
- [ ] 连续运行 24小时无崩溃
- [ ] 处理 1000+ 请求无异常
- [ ] 内存泄漏检测
- [ ] 文件句柄管理

## 🔍 调试检查点

### 1. 进程状态
```bash
ps aux | grep codex
lsof -i | grep codex
```

### 2. 文件系统
```bash
ls -la /tmp/codex-*.sock
ls -la /tmp/codex-*history.json
```

### 3. 网络连接
```bash
netstat -an | grep unix
ss -x | grep codex
```

### 4. 系统日志
```bash
journalctl -u your-service -f
tail -f /var/log/syslog | grep codex
```

## 📝 测试记录模板

### 测试会话 #1
```
日期: 2025-XX-XX
测试人员: [Name]
环境: [OS/Python版本]

测试结果:
- 工作流测试: ✅ 通过 (X/Y)
- 异常测试: ✅ 通过 (X/Y)
- 性能指标: ✅ 符合预期

发现问题:
1. [问题描述]
   - 严重程度: [高/中/低]
   - 状态: [待修复/已修复]

改进建议:
1. [建议内容]
```

## 🚀 发布前检查

### 代码质量
- [ ] 无语法错误
- [ ] 无明显性能问题
- [ ] 错误处理完善
- [ ] 日志记录合理

### 文档完整性
- [ ] README 文档更新
- [ ] API 文档完整
- [ ] 安装指南清晰
- [ ] 故障排除指南

### 测试覆盖
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试通过
- [ ] 手动测试完成
- [ ] 性能测试达标

### 安全检查
- [ ] 权限控制正确
- [ ] 输入验证完善
- [ ] 敏感信息保护
- [ ] 资源访问控制

## 📋 快速验证清单

### 5分钟快速检查
1. 服务能正常启动和停止
2. 基本问答功能正常
3. 配置切换生效
4. 异常情况有合理提示
5. 临时文件正确清理

### 30分钟完整检查
1. 运行所有自动化测试脚本
2. 验证所有命令和参数组合
3. 检查并发场景表现
4. 确认资源使用合理
5. 验证文档准确性

---

## 🎉 测试完成标准

当以下条件全部满足时，认为测试完成：

1. ✅ 所有核心功能测试通过
2. ✅ 异常场景测试通过率 > 90%
3. ✅ 性能指标达到预期
4. ✅ 安全检查全部通过
5. ✅ 文档更新完整

**最终签字确认：**

- 开发者: ________________ 日期: ________
- 测试者: ________________ 日期: ________
- 审核者: ________________ 日期: ________