#!/usr/bin/env python3
"""
Codex-ask命令入口点
支持同步和异步两种模式
"""

import sys
import os
from pathlib import Path

# 添加脚本目录到Python路径
script_dir = Path(__file__).resolve().parent
sys.path.insert(0, str(script_dir))

try:
    from codex_comm import CodexCommunicator

    def main():
        # 解析命令行参数
        args = sys.argv[1:]
        if not args:
            print("❌ 请提供问题内容")
            print("用法: /codex-ask [--wait|-w] <问题>")
            return 1

        # 检查是否为同步模式
        wait_mode = False
        wait_args = ['--wait', '-w']

        if args[0] in wait_args:
            wait_mode = True
            question = ' '.join(args[1:]) if len(args) > 1 else ''
        else:
            question = ' '.join(args)

        if not question.strip():
            print("❌ 问题内容不能为空")
            return 1

        try:
            comm = CodexCommunicator()

            if wait_mode:
                # 同步模式
                comm.ask_sync(question)
            else:
                # 异步模式
                comm.ask_async(question)

            return 0

        except Exception as e:
            print(f"❌ 执行失败: {e}")
            return 1

    if __name__ == "__main__":
        sys.exit(main())

except ImportError as e:
    print(f"❌ 导入模块失败: {e}")
    print("请确保 codex_comm.py 在同一目录下")
    sys.exit(1)